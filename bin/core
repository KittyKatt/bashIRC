#!/bin/bash
#Core connection to IRC
slap=$1
start=$(date +%s)
echo "$start" > .time
tail -f "$slap" | telnet $2 ${3:-6667} | \
while true
do read LINE || break
   echo "$LINE"
   #Ping controls
   if [ $(echo "$LINE" | awk '{print $1}') = "PING" ]; then
      echo "$LINE" | sed -e 's/PING/PONG/' >> "$slap"
      echo "$end" >> .end
      echo "PING Recieved from server @ $(echo $(date)| awk '{print $4}')"
   fi
   if [ "$bashirc_debug" = "1" ]; then
      #Thanks to Madhouse for finding this bug!
      bash -x botscript "$slap $LINE"
   else
      bash botscript "$slap $LINE"
   fi
done

